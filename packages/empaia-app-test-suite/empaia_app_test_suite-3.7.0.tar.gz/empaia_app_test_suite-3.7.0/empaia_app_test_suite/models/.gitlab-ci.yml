---
include:
  - project: "empaia/integration/ci-templates"
    ref: "main"
    file:
      - "pipeline-templates/pipeline-base.yml"
      - "job-templates/bot-add-release-version-tag.yml"
      - "job-templates/poetry-get-version.yml"

variables:
  RUNNER_TAG: "empaia-parallel"

poetry-get-version:
  extends: .poetry-get-version

poetry-codecheck:
  image: registry.gitlab.com/empaia/integration/ci-docker-images/test-runner
  before_script:
    - poetry install
  script:
    - poetry run black --check .
    - poetry run isort --check .
    - poetry run pycodestyle v1 v3
    - poetry run pylint v1 v3

poetry-pytest-v1:
  image: registry.gitlab.com/empaia/integration/ci-docker-images/test-runner
  before_script:
    - poetry install
  script:
    - poetry run pytest v1/tests --maxfail=1 -v -rx

poetry-pytest-v3:
  image: registry.gitlab.com/empaia/integration/ci-docker-images/test-runner
  before_script:
    - poetry install
  script:
    - poetry run pytest v3/tests --maxfail=1 -v -rx

poetry-pytest-utils:
  image: registry.gitlab.com/empaia/integration/ci-docker-images/test-runner
  before_script:
    - poetry install
  script:
    - poetry run pytest utils/tests --maxfail=1 -v -rx

bot-add-release-version-tag:
  extends: .bot-add-release-version-tag
  needs:
    - job: poetry-get-version
      artifacts: true
    - job: poetry-codecheck
    - job: poetry-pytest-v1
    - job: poetry-pytest-v3
    - job: poetry-pytest-utils
