var V=Object.defineProperty;var E=(l,e,o)=>e in l?V(l,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[e]=o;var f=(l,e,o)=>(E(l,typeof e!="symbol"?e+"":e,o),o);import{_ as L}from"./DocsButton.vue_vue_type_script_setup_true_lang.69b9fa5f.js";import{_ as B}from"./AbstraButton.vue_vue_type_script_setup_true_lang.9e42abd4.js";import{G as M}from"./PhDotsThreeVertical.vue.c39db334.js";import{e as R,f as q,cK as b,d as T,o as d,c as g,w as a,b as i,u as t,df as u,d3 as z,aF as c,R as _,da as C,ec as w,ea as O,$ as N,ed as F,X as m,aR as y,db as I,d9 as A,ee as k,bQ as P,by as G,bw as S,a as x,bK as K,cV as Q,el as X,em as Y}from"./vue-router.3fd92176.js";import{C as v}from"./gateway.c564a1cf.js";import{A as D}from"./Avatar.2107fa31.js";import{C as U}from"./Card.0ce127d8.js";import{A as H}from"./index.063f7c9e.js";import"./BookOutlined.5f7ad9dc.js";import"./popupNotifcation.0e86d6a8.js";import"./TabPane.d0ca7ad5.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[e]="8175aaa7-0f53-44fb-bfdd-bfcb4d36f4e1",l._sentryDebugIdIdentifier="sentry-dbid-8175aaa7-0f53-44fb-bfdd-bfcb4d36f4e1")}catch{}})();class J{async getLoginUrl(e,o,n,p){return v.get(`projects/${e}/connectors/${n}/connections/${o}/login-url`,{scopeIds:p.join(",")})}async listConnectors(e){return v.get(`projects/${e}/connectors`)}async listConnections(e){return v.get(`projects/${e}/connections`)}async deleteConnection(e){const{projectId:o,connectionName:n,connectorType:p}=e;return v.delete(`projects/${o}/connectors/${p}/connections/${n}`)}async renameConnection(e){const{projectId:o,connectionName:n,connectorType:p,newConnectionName:r}=e;return v.patch(`projects/${o}/connectors/${p}/connections/${n}`,{newConnectionName:r})}}class W{constructor(e,o){f(this,"state");f(this,"hasChanges",q(()=>!!this.state.value.editingConnection&&this.state.value.editingConnection.name!==this.state.value.editingConnection.newName));f(this,"handleDeletionClick",async e=>{b.confirm({title:"Delete connection",content:"Are you sure you want to delete this connection?",onOk:()=>this.handleDeleteConnection(e)})});f(this,"handleDeleteConnection",async e=>{await this.api.deleteConnection({projectId:this.projectId,connectionName:e.name,connectorType:e.connectorType}),this.state.value.editingConnection=null,await this.refetchConnections()});f(this,"handleAddConnectionSubmit",async()=>{var p,r;const e=(p=this.state.value.addingConnection)==null?void 0:p.connector.type,o=(r=this.state.value.addingConnection)==null?void 0:r.selectedScopeIds;if(!e||!o)throw new Error("No connector or scope selected");const{url:n}=await this.getLoginUrl(e,this.getUniqueName(e),o);window.location.href=n});f(this,"renameConnection",async()=>{const{editingConnection:e}=this.state.value;if(!e)throw new Error("No connection is being edited");const o=async()=>{await this.api.renameConnection({projectId:this.projectId,connectionName:e.name,connectorType:e.connectorType,newConnectionName:e.newName}),await this.refetchConnections(),this.state.value.editingConnection=null};b.confirm({title:"Rename connection",content:"Are you sure you want to rename this connection? This will break any existing references to the old name.",onOk:o})});f(this,"showAddConfirmationModal",e=>{this.state.value.addingConnection={selectedScopeIds:e.scopes.map(o=>o.id),connector:e}});f(this,"handleScopeToggle",(e,o)=>{o?this.state.value.addingConnection.selectedScopeIds.push(e):this.state.value.addingConnection.selectedScopeIds=this.state.value.addingConnection.selectedScopeIds.filter(n=>n!==e)});this.projectId=e,this.api=o,this.state=R({connectors:[],connections:[],addingConnection:null,editingConnection:null})}async fetchConnectors(){this.state.value.connectors=await this.api.listConnectors(this.projectId)}async fetchInitialState(){await this.fetchConnectors(),await this.refetchConnections()}async refetchConnections(){this.state.value.connections=(await this.api.listConnections(this.projectId)).map(e=>{const o=this.state.value.connectors.find(n=>n.type===e.connectorType);if(!o)throw new Error(`Unknown connector type: ${e.connectorType}`);return{name:e.name,connectorTitle:o.title,connectorType:e.connectorType,icon:o.logoUrl}})}handleEditConnectionClick(e){this.state.value.editingConnection={...e,newName:e.name}}async getLoginUrl(e,o,n){return this.api.getLoginUrl(this.projectId,o,e,n)}slugify(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-")}getUniqueName(e){const o=this.state.value.connections.filter(n=>n.connectorType===e).length;return o===0?e:`${e}-${o}`}}const Z=T({__name:"ConnectorCard",props:{title:{},logoUrl:{},description:{},unavailable:{type:Boolean}},setup(l){return(e,o)=>(d(),g(t(U),{class:O({"connector-card":!0,unavailable:e.unavailable})},{default:a(()=>[i(t(u),{style:{width:"100%"},vertical:"",gap:12},{default:a(()=>[i(t(u),{justify:"space-between"},{default:a(()=>[i(t(D),{src:e.logoUrl,shape:"square",size:"large"},null,8,["src"]),e.unavailable?(d(),g(t(z),{key:0,style:{height:"fit-content"}},{default:a(()=>[c("Coming Soon")]),_:1})):_("",!0)]),_:1}),i(t(u),{vertical:""},{default:a(()=>[i(t(C),{strong:""},{default:a(()=>[c(w(e.title),1)]),_:1}),i(t(C),{type:"secondary"},{default:a(()=>[c(w(e.description),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["class"]))}});const ee=N(Z,[["__scopeId","data-v-d00fdb70"]]),te=l=>(X("data-v-efd73617"),l=l(),Y(),l),ne=te(()=>x("div",{style:{"flex-grow":"1"}},null,-1)),oe={class:"connectors-grid"},ae=T({__name:"ConnectorsView",setup(l){const o=F().params.projectId,n=new W(o,new J);return n.fetchInitialState(),(p,r)=>{var $,j;return d(),m(y,null,[i(t(H),{direction:"vertical",style:{width:"100%","margin-bottom":"30px"}},{default:a(()=>[i(t(u),{align:"center",justify:"space-between"},{default:a(()=>[i(t(I),null,{default:a(()=>[c("Connectors")]),_:1})]),_:1}),i(t(A),null,{default:a(()=>[c(" Add and manage external integrations to your project. "),i(L)]),_:1}),t(n).state.value.connections.length?(d(),g(t(u),{key:0,vertical:""},{default:a(()=>[i(t(I),{level:2},{default:a(()=>[c("Installed")]),_:1}),i(t(u),{vertical:"",gap:10},{default:a(()=>[(d(!0),m(y,null,k(t(n).state.value.connections,s=>(d(),g(t(U),{key:s.name},{default:a(()=>[i(t(u),{align:"center",gap:20},{default:a(()=>[i(t(D),{src:s.icon,height:"40px",shape:"square"},null,8,["src"]),i(t(C),{strong:""},{default:a(()=>[c(w(s.connectorTitle),1)]),_:2},1024),ne,i(t(C),{content:s.name,copyable:"",code:""},null,8,["content"]),i(t(P),null,{overlay:a(()=>[i(t(G),null,{default:a(()=>[i(t(S),{onClick:h=>t(n).handleEditConnectionClick(s)},{default:a(()=>[c(" Rename ")]),_:2},1032,["onClick"]),i(t(S),{danger:"",onClick:h=>t(n).handleDeletionClick(s)},{default:a(()=>[c(" Delete ")]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[i(t(M))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):_("",!0),i(t(u),{vertical:""},{default:a(()=>[t(n).state.value.connections.length?(d(),g(t(I),{key:0,level:2},{default:a(()=>[c("Available")]),_:1})):_("",!0),x("div",oe,[(d(!0),m(y,null,k(t(n).state.value.connectors.sort((s,h)=>s.unavailable?1:-1),s=>(d(),g(ee,{key:s.type,title:s.title,"logo-url":s.logoUrl,description:s.description,unavailable:s.unavailable,onClick:h=>t(n).showAddConfirmationModal(s)},null,8,["title","logo-url","description","unavailable","onClick"]))),128))])]),_:1})]),_:1}),i(t(b),{open:!!t(n).state.value.editingConnection,title:`${($=t(n).state.value.editingConnection)==null?void 0:$.connectorTitle} Connection`,onCancel:r[2]||(r[2]=s=>t(n).state.value.editingConnection=null)},{footer:a(()=>[i(t(u),{justify:"end"},{default:a(()=>[i(B,{disabled:!t(n).hasChanges.value,onClick:r[1]||(r[1]=s=>t(n).renameConnection())},{default:a(()=>[c(" Save ")]),_:1},8,["disabled"])]),_:1})]),default:a(()=>[t(n).state.value.editingConnection?(d(),g(t(K),{key:0,value:t(n).state.value.editingConnection.newName,"onUpdate:value":r[0]||(r[0]=s=>t(n).state.value.editingConnection.newName=s)},null,8,["value"])):_("",!0)]),_:1},8,["open","title"]),i(t(b),{open:!!t(n).state.value.addingConnection,title:`Add ${(j=t(n).state.value.addingConnection)==null?void 0:j.connector.title} Connection`,"ok-text":"Authorize","wrap-class-name":"full-modal",onCancel:r[3]||(r[3]=s=>t(n).state.value.addingConnection=null),onOk:t(n).handleAddConnectionSubmit},{default:a(()=>[t(n).state.value.addingConnection?(d(),m(y,{key:0},[i(t(A),null,{default:a(()=>[c(" Please select the scopes you want to authorize for this connection. You can change these later by deleting and re-adding the connection. ")]),_:1}),i(t(u),{vertical:"",gap:"10",style:{margin:"30px 0px"}},{default:a(()=>[(d(!0),m(y,null,k(t(n).state.value.addingConnection.connector.scopes,s=>(d(),g(t(u),{key:s.id,justify:"space-between",align:"center"},{default:a(()=>[i(t(u),{vertical:""},{default:a(()=>[i(t(C),null,{default:a(()=>[c(w(s.description),1)]),_:2},1024),i(t(C),{type:"secondary"},{default:a(()=>[c(w(s.id),1)]),_:2},1024)]),_:2},1024),i(t(Q),{checked:t(n).state.value.addingConnection.selectedScopeIds.includes(s.id),onChange:h=>t(n).handleScopeToggle(s.id,h)},null,8,["checked","onChange"])]),_:2},1024))),128))]),_:1})],64)):_("",!0)]),_:1},8,["open","title","onOk"])],64)}}});const me=N(ae,[["__scopeId","data-v-efd73617"]]);export{me as default};
//# sourceMappingURL=ConnectorsView.b63d2fed.js.map
