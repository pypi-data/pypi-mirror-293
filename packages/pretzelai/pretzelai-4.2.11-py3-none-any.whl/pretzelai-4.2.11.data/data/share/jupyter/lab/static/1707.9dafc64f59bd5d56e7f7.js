"use strict";(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[1707],{11707:(e,t,r)=>{r.r(t);r.d(t,{Change:()=>u,Chunk:()=>J,MergeView:()=>ye,acceptChunk:()=>qe,diff:()=>j,getChunks:()=>W,getOriginalDoc:()=>Pe,goToNextChunk:()=>Y,goToPreviousChunk:()=>$,originalDocChangeEffect:()=>Fe,presentableDiff:()=>_,rejectChunk:()=>ze,unifiedMergeView:()=>Ge,updateOriginalDoc:()=>Ne});var i=r(22819);var n=r.n(i);var o=r(71674);var l=r.n(o);var s=r(23546);var a=r.n(s);var f=r(4452);var c=r.n(f);var h=r(45145);var d=r.n(h);class u{constructor(e,t,r,i){this.fromA=e;this.toA=t;this.fromB=r;this.toB=i}offset(e,t){return new u(this.fromA+e,this.toA+e,this.fromB+t,this.toB+t)}}function m(e,t,r,i,n,o){if(e==i)return[];let l=C(e,t,r,i,n,o);let s=k(e,t+l,r,i,n+l,o);t+=l;r-=s;n+=l;o-=s;let a=r-t,f=o-n;if(!a||!f)return[new u(t,r,n,o)];if(a>f){let l=e.slice(t,r).indexOf(i.slice(n,o));if(l>-1)return[new u(t,t+l,n,n),new u(t+l+f,r,o,o)]}else if(f>a){let l=i.slice(n,o).indexOf(e.slice(t,r));if(l>-1)return[new u(t,t,n,n+l),new u(r,r,n+l+a,o)]}if(a==1||f==1)return[new u(t,r,n,o)];let c=M(e,t,r,i,n,o);if(c){let[l,s,a]=c;return m(e,t,l,i,n,s).concat(m(e,l+a,r,i,s+a,o))}return p(e,t,r,i,n,o)}let g=1e9;function p(e,t,r,i,n,o){let l=r-t,s=o-n;if(g<1e9&&Math.min(l,s)>g*16){if(Math.min(l,s)>g*64)return[new u(t,r,n,o)];return D(e,t,r,i,n,o)}let a=Math.ceil((l+s)/2);v.reset(a);w.reset(a);let f=(r,o)=>e.charCodeAt(t+r)==i.charCodeAt(n+o);let c=(t,n)=>e.charCodeAt(r-t-1)==i.charCodeAt(o-n-1);let h=(l-s)%2!=0?w:null,d=h?null:v;for(let u=0;u<a;u++){if(u>g)return D(e,t,r,i,n,o);let m=v.advance(u,l,s,a,h,false,f)||w.advance(u,l,s,a,d,true,c);if(m)return b(e,t,r,t+m[0],i,n,o,n+m[1])}return[new u(t,r,n,o)]}class A{constructor(){this.vec=[]}reset(e){this.len=e<<1;for(let t=0;t<this.len;t++)this.vec[t]=-1;this.vec[e+1]=0;this.start=this.end=0}advance(e,t,r,i,n,o,l){for(let s=-e+this.start;s<=e-this.end;s+=2){let a=i+s;let f=s==-e||s!=e&&this.vec[a-1]<this.vec[a+1]?this.vec[a+1]:this.vec[a-1]+1;let c=f-s;while(f<t&&c<r&&l(f,c)){f++;c++}this.vec[a]=f;if(f>t){this.end+=2}else if(c>r){this.start+=2}else if(n){let e=i+(t-r)-s;if(e>=0&&e<this.len&&n.vec[e]!=-1){if(!o){let r=t-n.vec[e];if(f>=r)return[f,c]}else{let r=n.vec[e];if(r>=t-f)return[r,i+r-e]}}}}return null}}const v=new A,w=new A;function b(e,t,r,i,n,o,l,s){let a=false;if(!P(e,i)&&++i==r)a=true;if(!P(n,s)&&++s==l)a=true;if(a)return[new u(t,r,o,l)];return m(e,t,i,n,o,s).concat(m(e,i,r,n,s,l))}function B(e,t){let r=1,i=Math.min(e,t);while(r<i)r=r<<1;return r}function C(e,t,r,i,n,o){if(t==r||t==o||e.charCodeAt(t)!=i.charCodeAt(n))return 0;let l=B(r-t,o-n);for(let s=t,a=n;;){let n=s+l,f=a+l;if(n>r||f>o||e.slice(s,n)!=i.slice(a,f)){if(l==1)return s-t-(P(e,s)?0:1);l=l>>1}else if(n==r||f==o){return n-t}else{s=n;a=f}}}function k(e,t,r,i,n,o){if(t==r||n==o||e.charCodeAt(r-1)!=i.charCodeAt(o-1))return 0;let l=B(r-t,o-n);for(let s=r,a=o;;){let o=s-l,f=a-l;if(o<t||f<n||e.slice(o,s)!=i.slice(f,a)){if(l==1)return r-s-(P(e,s)?0:1);l=l>>1}else if(o==t||f==n){return r-o}else{s=o;a=f}}}function x(e,t,r,i,n,o,l,s){let a=i.slice(n,o);let f=null;for(;;){if(f||l<s)return f;for(let s=t+l;;){if(!P(e,s))s++;let c=s+l;if(!P(e,c))c+=c==s+1?1:-1;if(c>=r)break;let h=e.slice(s,c);let d=-1;while((d=a.indexOf(h,d+1))!=-1){let l=C(e,c,r,i,n+d+h.length,o);let a=k(e,t,s,i,n,n+d);let u=h.length+l+a;if(!f||f[2]<u)f=[s-a,n+d-a,u]}s=c}if(s<0)return f;l=l>>1}}function M(e,t,r,i,n,o){let l=r-t,s=o-n;if(l<s){let l=M(i,n,o,e,t,r);return l&&[l[1],l[0],l[2]]}if(l<4||s*2<l)return null;return x(e,t,r,i,n,o,Math.floor(l/4),-1)}function D(e,t,r,i,n,o){let l=r-t,s=o-n;let a;if(l<s){let s=x(i,n,o,e,t,r,Math.floor(l/6),50);a=s&&[s[1],s[0],s[2]]}else{a=x(e,t,r,i,n,o,Math.floor(s/6),50)}if(!a)return[new u(t,r,n,o)];let[f,c,h]=a;return m(e,t,f,i,n,c).concat(m(e,f+h,r,i,c+h,o))}function E(e,t){for(let r=1;r<e.length;r++){let i=e[r-1],n=e[r];if(i.toA>n.fromA-t&&i.toB>n.fromB-t){e[r-1]=new u(i.fromA,n.toA,i.fromB,n.toB);e.splice(r--,1)}}}function S(e,t,r){for(;;){E(r,1);let i=false;for(let n=0;n<r.length;n++){let o=r[n],l,s;if(l=C(e,o.fromA,o.toA,t,o.fromB,o.toB))o=r[n]=new u(o.fromA+l,o.toA,o.fromB+l,o.toB);if(s=k(e,o.fromA,o.toA,t,o.fromB,o.toB))o=r[n]=new u(o.fromA,o.toA-s,o.fromB,o.toB-s);let a=o.toA-o.fromA,f=o.toB-o.fromB;if(a&&f)continue;let c=o.fromA-(n?r[n-1].toA:0);let h=(n<r.length-1?r[n+1].fromA:e.length)-o.toA;if(!c||!h)continue;let d=a?e.slice(o.fromA,o.toA):t.slice(o.fromB,o.toB);if(c<=d.length&&e.slice(o.fromA-c,o.fromA)==d.slice(d.length-c)){r[n]=new u(o.fromA-c,o.toA-c,o.fromB-c,o.toB-c);i=true}else if(h<=d.length&&e.slice(o.toA,o.toA+h)==d.slice(0,h)){r[n]=new u(o.fromA+h,o.toA+h,o.fromB+h,o.toB+h);i=true}}if(!i)break}return r}function O(e,t,r){for(let i=0,n=0;n<e.length;n++){let o=e[n];let l=o.toA-o.fromA,s=o.toB-o.fromB;if(l&&s||l>3||s>3){let a=n==e.length-1?t.length:e[n+1].fromA;let f=o.fromA-i,c=a-o.toA;let h=G(t,o.fromA,Math.min(f,5));let d=V(t,o.toA,Math.min(c,5));let m=o.fromA-h,g=d-o.toA;if(!l||!s){let c=Math.max(l,s);let[p,A,v]=l?[t,o.fromA,o.toA]:[r,o.fromB,o.toB];let w,b;if(m&&g){if(c>m&&t.slice(h,o.fromA)==p.slice(v-m,v)){o=e[n]=new u(h,h+l,o.fromB-m,o.toB-m);h=o.fromA;d=V(t,o.toA,Math.min(a-o.toA,5))}else if(c>g&&t.slice(o.toA,d)==p.slice(A,A+g)){o=e[n]=new u(d-l,d,o.fromB+g,o.toB+g);d=o.toA;h=G(t,o.fromA,Math.min(o.fromA-i,5))}m=o.fromA-h;g=d-o.toA}else if(!m&&!g&&(b=o.fromA-(w=N(t,o.fromA,f)))&&t.slice(w,o.fromA)==p.slice(v-b,v)){o=e[n]=new u(w,w+l,o.fromB-b,o.toB-b)}}if(m||g){o=e[n]=new u(o.fromA-m,o.toA+g,o.fromB-m,o.toB+g)}i=o.toA}}E(e,3);return e}let L;try{L=new RegExp("[\\p{Alphabetic}\\p{Number}]","u")}catch(Ye){}function y(e){return e>48&&e<58||e>64&&e<91||e>96&&e<123}function T(e,t){if(t==e.length)return 0;let r=e.charCodeAt(t);if(r<192)return y(r)?1:0;if(!L)return 0;if(!F(r)||t==e.length-1)return L.test(String.fromCharCode(r))?1:0;return L.test(e.slice(t,t+2))?2:0}function R(e,t){if(!t)return 0;let r=e.charCodeAt(t-1);if(r<192)return y(r)?1:0;if(!L)return 0;if(!H(r)||t==1)return L.test(String.fromCharCode(r))?1:0;return L.test(e.slice(t-2,t))?2:0}function V(e,t,r){if(t==e.length||!R(e,t))return t;for(let i=t,n=t+r;;){let r=T(e,i);if(!r)return i;i+=r;if(i>n)return t}}function G(e,t,r){if(!t||!T(e,t))return t;for(let i=t,n=t-r;;){let r=R(e,i);if(!r)return i;i-=r;if(i<n)return t}}function N(e,t,r){for(let i=t,n=t-r;;){let r=i?e.charCodeAt(i-1):10;if(r==10)return i;i--;if(i<n||r!=32&&r!=9)return t}}const F=e=>e>=55296&&e<=56319;const H=e=>e>=56320&&e<=57343;function P(e,t){return!t||t==e.length||!F(e.charCodeAt(t-1))||!H(e.charCodeAt(t))}function j(e,t,r){var i;g=((i=r===null||r===void 0?void 0:r.scanLimit)!==null&&i!==void 0?i:1e9)>>1;return S(e,t,m(e,0,e.length,t,0,t.length))}function _(e,t,r){return O(j(e,t,r),e,t)}const U=o.Facet.define({combine:e=>e[0]});const q=o.StateEffect.define();const z=o.StateField.define({create(e){return null},update(e,t){for(let r of t.effects)if(r.is(q))e=r.value;return e}});function W(e){let t=e.field(z,false);if(!t)return null;let r=e.facet(U);return{chunks:t,side:r?r.side:null}}let I=e=>({state:t,dispatch:r})=>{let n=t.field(z,false),l=t.facet(U);if(!n||!n.length||!l)return false;let{head:s}=t.selection.main,a=0;for(let i=n.length-1;i>=0;i--){let t=n[i];let[r,o]=l.side=="b"?[t.fromB,t.toB]:[t.fromA,t.toA];if(o<s){a=i+1;break}if(r<=s){if(n.length==1)return false;a=i+(e<0?0:1);break}}let f=n[(a+(e<0?n.length-1:0))%n.length];let[c,h]=l.side=="b"?[f.fromB,f.toB]:[f.fromA,f.toA];r(t.update({selection:{anchor:c},userEvent:"select.byChunk",effects:i.EditorView.scrollIntoView(o.EditorSelection.range(h,c))}));return true};const Y=I(1);const $=I(-1);class J{constructor(e,t,r,i,n){this.changes=e;this.fromA=t;this.toA=r;this.fromB=i;this.toB=n}offset(e,t){return e||t?new J(this.changes,this.fromA+e,this.toA+e,this.fromB+t,this.toB+t):this}get endA(){return Math.max(this.fromA,this.toA-1)}get endB(){return Math.max(this.fromB,this.toB-1)}static build(e,t,r){return X(_(e.toString(),t.toString(),r),e,t,0,0)}static updateA(e,t,r,i,n){return re(te(e,i,true,r.length),e,t,r,n)}static updateB(e,t,r,i,n){return re(te(e,i,false,t.length),e,t,r,n)}}function K(e,t,r,i){let n=r.lineAt(e),o=i.lineAt(t);return n.to==e&&o.to==t&&e<r.length&&t<i.length?[e+1,t+1]:[n.from,o.from]}function Q(e,t,r,i){let n=r.lineAt(e),o=i.lineAt(t);return n.from==e&&o.from==t?[e,t]:[n.to+1,o.to+1]}function X(e,t,r,i,n){let o=[];for(let l=0;l<e.length;l++){let s=e[l];let[a,f]=K(s.fromA+i,s.fromB+n,t,r);let[c,h]=Q(s.toA+i,s.toB+n,t,r);let d=[s.offset(-a+i,-f+n)];while(l<e.length-1){let o=e[l+1];let[s,u]=K(o.fromA+i,o.fromB+n,t,r);if(s>c+1&&u>h+1)break;d.push(o.offset(-a+i,-f+n));[c,h]=Q(o.toA+i,o.toB+n,t,r);l++}o.push(new J(d,a,Math.max(a,c),f,Math.max(f,h)))}return o}const Z=1e3;function ee(e,t,r,i){let n=0,o=e.length;for(;;){if(n==o){let i=0,o=0;if(n)({toA:i,toB:o}=e[n-1]);let l=t-(r?i:o);return[i+l,o+l]}let l=n+o>>1,s=e[l];let[a,f]=r?[s.fromA,s.toA]:[s.fromB,s.toB];if(a>t)o=l;else if(f<=t)n=l+1;else return i?[s.fromA,s.fromB]:[s.toA,s.toB]}}function te(e,t,r,i){let n=[];t.iterChangedRanges(((o,l,s,a)=>{let f=0,c=r?t.length:i;let h=0,d=r?i:t.length;if(o>Z)[f,h]=ee(e,o-Z,r,true);if(l<t.length-Z)[c,d]=ee(e,l+Z,r,false);let u=a-s-(l-o),m;let[g,p]=r?[u,0]:[0,u];if(n.length&&(m=n[n.length-1]).toA>=f)n[n.length-1]={fromA:m.fromA,fromB:m.fromB,toA:c,toB:d,diffA:m.diffA+g,diffB:m.diffB+p};else n.push({fromA:f,toA:c,fromB:h,toB:d,diffA:g,diffB:p})}));return n}function re(e,t,r,i,n){if(!e.length)return t;let o=[];for(let l=0,s=0,a=0,f=0;;l++){let c=l==e.length?null:e[l];let h=c?c.fromA+s:r.length,d=c?c.fromB+a:i.length;while(f<t.length){let e=t[f];if(e.toA+s>h||e.toB+a>d)break;o.push(e.offset(s,a));f++}if(!c)break;let u=c.toA+s+c.diffA,m=c.toB+a+c.diffB;let g=_(r.sliceString(h,u),i.sliceString(d,m),n);for(let e of X(g,r,i,h,d))o.push(e);s+=c.diffA;a+=c.diffB;while(f<t.length){let e=t[f];if(e.fromA+s>u&&e.fromB+a>m)break;f++}}return o}const ie={scanLimit:500};const ne=i.ViewPlugin.fromClass(class{constructor(e){({deco:this.deco,gutter:this.gutter}=me(e))}update(e){if(e.docChanged||e.viewportChanged||le(e.startState,e.state)||se(e.startState,e.state))({deco:this.deco,gutter:this.gutter}=me(e.view))}},{decorations:e=>e.deco});const oe=o.Prec.low((0,i.gutter)({class:"cm-changeGutter",markers:e=>{var t;return((t=e.plugin(ne))===null||t===void 0?void 0:t.gutter)||o.RangeSet.empty}}));function le(e,t){return e.field(z,false)!=t.field(z,false)}function se(e,t){return e.facet(U)!=t.facet(U)}const ae=i.Decoration.line({class:"cm-changedLine"});const fe=i.Decoration.mark({class:"cm-changedText"});const ce=i.Decoration.mark({tagName:"ins",class:"cm-insertedLine"});const he=i.Decoration.mark({tagName:"del",class:"cm-deletedLine"});const de=new class extends i.GutterMarker{constructor(){super(...arguments);this.elementClass="cm-changedLineGutter"}};function ue(e,t,r,i,n,o){let l=r?e.fromA:e.fromB,s=r?e.toA:e.toB;let a=0;if(l!=s){n.add(l,l,ae);n.add(l,s,r?he:ce);if(o)o.add(l,l,de);for(let f=t.iterRange(l,s-1),c=l;!f.next().done;){if(f.lineBreak){c++;n.add(c,c,ae);if(o)o.add(c,c,de);continue}let t=c+f.value.length;if(i)while(a<e.changes.length){let i=e.changes[a];let o=l+(r?i.fromA:i.fromB);let s=l+(r?i.toA:i.toB);let f=Math.max(c,o),h=Math.min(t,s);if(f<h)n.add(f,h,fe);if(s<t)a++;else break}c=t}}}function me(e){let t=e.state.field(z);let{side:r,highlightChanges:i,markGutter:n}=e.state.facet(U),l=r=="a";let s=new o.RangeSetBuilder;let a=n?new o.RangeSetBuilder:null;let{from:f,to:c}=e.viewport;for(let o of t){if((l?o.fromA:o.fromB)>=c)break;if((l?o.toA:o.toB)>f)ue(o,e.state.doc,l,i,s,a)}return{deco:s.finish(),gutter:a&&a.finish()}}class ge extends i.WidgetType{constructor(e){super();this.height=e}eq(e){return this.height==e.height}toDOM(){let e=document.createElement("div");e.className="cm-mergeSpacer";e.style.height=this.height+"px";return e}updateDOM(e){e.style.height=this.height+"px";return true}get estimatedHeight(){return this.height}ignoreEvent(){return false}}const pe=o.StateEffect.define({map:(e,t)=>e.map(t)});const Ae=o.StateField.define({create:()=>i.Decoration.none,update:(e,t)=>{for(let r of t.effects)if(r.is(pe))return r.value;return e.map(t.changes)},provide:e=>i.EditorView.decorations.from(e)});const ve=.01;function we(e,t){if(e.size!=t.size)return false;let r=e.iter(),i=t.iter();while(r.value){if(r.from!=i.from||Math.abs(r.value.spec.widget.height-i.value.spec.widget.height)>1)return false;r.next();i.next()}return true}function be(e,t,r){let n=new o.RangeSetBuilder,l=new o.RangeSetBuilder;let s=e.state.field(Ae).iter(),a=t.state.field(Ae).iter();let f=0,c=0,h=0,d=0,u=e.viewport,m=t.viewport;for(let o=0;;o++){let g=o<r.length?r[o]:null;let p=g?g.fromA:e.state.doc.length,A=g?g.fromB:t.state.doc.length;if(f<p){let r=e.lineBlockAt(f).top+h;let o=t.lineBlockAt(c).top+d;let s=r-o;if(s<-ve){h-=s;n.add(f,f,i.Decoration.widget({widget:new ge(-s),block:true,side:-1}))}else if(s>ve){d+=s;l.add(c,c,i.Decoration.widget({widget:new ge(s),block:true,side:-1}))}}if(p>f+1e3&&f<u.from&&p>u.from&&c<m.from&&A>m.from){let e=Math.min(u.from-f,m.from-c);f+=e;c+=e;o--}else if(!g){break}else{f=g.toA;c=g.toB}while(s.value&&s.from<f){h-=s.value.spec.widget.height;s.next()}while(a.value&&a.from<c){d-=a.value.spec.widget.height;a.next()}}while(s.value){h-=s.value.spec.widget.height;s.next()}while(a.value){d-=a.value.spec.widget.height;a.next()}let g=e.contentHeight+h-(t.contentHeight+d);if(g<ve){n.add(e.state.doc.length,e.state.doc.length,i.Decoration.widget({widget:new ge(-g),block:true,side:1}))}else if(g>ve){l.add(t.state.doc.length,t.state.doc.length,i.Decoration.widget({widget:new ge(g),block:true,side:1}))}let p=n.finish(),A=l.finish();if(!we(p,e.state.field(Ae)))e.dispatch({effects:pe.of(p)});if(!we(A,t.state.field(Ae)))t.dispatch({effects:pe.of(A)})}const Be=o.StateEffect.define({map:(e,t)=>t.mapPos(e)});class Ce extends i.WidgetType{constructor(e){super();this.lines=e}eq(e){return this.lines==e.lines}toDOM(e){let t=document.createElement("div");t.className="cm-collapsedLines";t.textContent="⦚ "+e.state.phrase("$ unchanged lines",this.lines)+" ⦚";t.addEventListener("click",(t=>{let r=e.posAtDOM(t.target);e.dispatch({effects:Be.of(r)});let{side:i,sibling:n}=e.state.facet(U);if(n)n().dispatch({effects:Be.of(ke(r,e.state.field(z),i=="a"))})}));return t}ignoreEvent(e){return e instanceof MouseEvent}get estimatedHeight(){return 27}}function ke(e,t,r){let i=0,n=0;for(let o=0;;o++){let l=o<t.length?t[o]:null;if(!l||(r?l.fromA:l.fromB)>=e)return n+(e-i);[i,n]=r?[l.toA,l.toB]:[l.toB,l.toA]}}const xe=o.StateField.define({create(e){return i.Decoration.none},update(e,t){e=e.map(t.changes);for(let r of t.effects)if(r.is(Be))e=e.update({filter:e=>e!=r.value});return e},provide:e=>i.EditorView.decorations.from(e)});function Me({margin:e=3,minSize:t=4}){return xe.init((r=>De(r,e,t)))}function De(e,t,r){let n=new o.RangeSetBuilder;let l=e.facet(U).side=="a";let s=e.field(z);let a=1;for(let o=0;;o++){let f=o<s.length?s[o]:null;let c=o?a+t:1;let h=f?e.doc.lineAt(l?f.fromA:f.fromB).number-1-t:e.doc.lines;let d=h-c+1;if(d>=r){n.add(e.doc.line(c).from,e.doc.line(h).to,i.Decoration.replace({widget:new Ce(d),block:true}))}if(!f)break;a=e.doc.lineAt(Math.min(e.doc.length,l?f.toA:f.toB)).number}return n.finish()}const Ee=i.EditorView.styleModule.of(new s.StyleModule({".cm-mergeView":{overflowY:"auto"},".cm-mergeViewEditors":{display:"flex",alignItems:"stretch"},".cm-mergeViewEditor":{flexGrow:1,flexBasis:0,overflow:"hidden"},".cm-merge-revert":{width:"1.6em",flexGrow:0,flexShrink:0,position:"relative"},".cm-merge-revert button":{position:"absolute",display:"block",width:"100%",boxSizing:"border-box",textAlign:"center",background:"none",border:"none",font:"inherit",cursor:"pointer"}}));const Se=i.EditorView.baseTheme({".cm-mergeView & .cm-scroller, .cm-mergeView &":{height:"auto !important",overflowY:"visible !important"},"&.cm-merge-a .cm-changedLine, .cm-deletedChunk":{backgroundColor:"rgba(160, 128, 100, .08)"},"&.cm-merge-b .cm-changedLine":{backgroundColor:"rgba(100, 160, 128, .08)"},"&light.cm-merge-a .cm-changedText, &light .cm-deletedChunk .cm-deletedText":{background:"linear-gradient(#ee443366, #ee443366) bottom/100% 2px no-repeat"},"&dark.cm-merge-a .cm-changedText, &dark .cm-deletedChunk .cm-deletedText":{background:"linear-gradient(#ffaa9966, #ffaa9966) bottom/100% 2px no-repeat"},"&light.cm-merge-b .cm-changedText":{background:"linear-gradient(#22bb2266, #22bb2266) bottom/100% 2px no-repeat"},"&dark.cm-merge-b .cm-changedText":{background:"linear-gradient(#88ff8866, #88ff8866) bottom/100% 2px no-repeat"},".cm-insertedLine, .cm-deletedLine":{textDecoration:"none"},".cm-deletedChunk":{paddingLeft:"6px","& .cm-chunkButtons":{position:"absolute",insetInlineEnd:"5px"},"& button":{border:"none",cursor:"pointer",color:"white",margin:"0 2px",borderRadius:"3px","&[name=accept]":{background:"#2a2"},"&[name=reject]":{background:"#d43"}}},".cm-collapsedLines":{padding:"5px 5px 5px 10px",cursor:"pointer"},"&light .cm-collapsedLines":{color:"#444",background:"linear-gradient(to bottom, transparent 0, #f3f3f3 30%, #f3f3f3 70%, transparent 100%)"},"&dark .cm-collapsedLines":{color:"#ddd",background:"linear-gradient(to bottom, transparent 0, #222 30%, #222 70%, transparent 100%)"},".cm-changeGutter":{width:"3px",paddingLeft:"1px"},"&light.cm-merge-a .cm-changedLineGutter, &light .cm-deletedLineGutter":{background:"#e43"},"&dark.cm-merge-a .cm-changedLineGutter, &dark .cm-deletedLineGutter":{background:"#fa9"},"&light.cm-merge-b .cm-changedLineGutter":{background:"#2b2"},"&dark.cm-merge-b .cm-changedLineGutter":{background:"#8f8"}});const Oe=new o.Compartment,Le=new o.Compartment;class ye{constructor(e){this.revertDOM=null;this.revertToA=false;this.revertToLeft=false;this.measuring=-1;this.diffConf=e.diffConfig||ie;let t=[o.Prec.low(ne),Se,Ee,Ae,i.EditorView.updateListener.of((e=>{if(this.measuring<0&&(e.heightChanged||e.viewportChanged)&&!e.transactions.some((e=>e.effects.some((e=>e.is(pe))))))this.measure()}))];let r=[U.of({side:"a",sibling:()=>this.b,highlightChanges:e.highlightChanges!==false,markGutter:e.gutter!==false})];if(e.gutter!==false)r.push(oe);let n=o.EditorState.create({doc:e.a.doc,selection:e.a.selection,extensions:[e.a.extensions||[],i.EditorView.editorAttributes.of({class:"cm-merge-a"}),Le.of(r),t]});let l=[U.of({side:"b",sibling:()=>this.a,highlightChanges:e.highlightChanges!==false,markGutter:e.gutter!==false})];if(e.gutter!==false)l.push(oe);let s=o.EditorState.create({doc:e.b.doc,selection:e.b.selection,extensions:[e.b.extensions||[],i.EditorView.editorAttributes.of({class:"cm-merge-b"}),Le.of(l),t]});this.chunks=J.build(n.doc,s.doc,this.diffConf);let a=[z.init((()=>this.chunks)),Oe.of(e.collapseUnchanged?Me(e.collapseUnchanged):[])];n=n.update({effects:o.StateEffect.appendConfig.of(a)}).state;s=s.update({effects:o.StateEffect.appendConfig.of(a)}).state;this.dom=document.createElement("div");this.dom.className="cm-mergeView";this.editorDOM=this.dom.appendChild(document.createElement("div"));this.editorDOM.className="cm-mergeViewEditors";let f=e.orientation||"a-b";let c=document.createElement("div");c.className="cm-mergeViewEditor";let h=document.createElement("div");h.className="cm-mergeViewEditor";this.editorDOM.appendChild(f=="a-b"?c:h);this.editorDOM.appendChild(f=="a-b"?h:c);this.a=new i.EditorView({state:n,parent:c,root:e.root,dispatchTransactions:e=>this.dispatch(e,this.a)});this.b=new i.EditorView({state:s,parent:h,root:e.root,dispatchTransactions:e=>this.dispatch(e,this.b)});this.setupRevertControls(!!e.revertControls,e.revertControls=="b-to-a",e.renderRevertControl);if(e.parent)e.parent.appendChild(this.dom);this.scheduleMeasure()}dispatch(e,t){if(e.some((e=>e.docChanged))){let r=e[e.length-1];let i=e.reduce(((e,t)=>e.compose(t.changes)),o.ChangeSet.empty(e[0].startState.doc.length));this.chunks=t==this.a?J.updateA(this.chunks,r.newDoc,this.b.state.doc,i,this.diffConf):J.updateB(this.chunks,this.a.state.doc,r.newDoc,i,this.diffConf);t.update([...e,r.state.update({effects:q.of(this.chunks)})]);let n=t==this.a?this.b:this.a;n.update([n.state.update({effects:q.of(this.chunks)})]);this.scheduleMeasure()}else{t.update(e)}}reconfigure(e){if("diffConfig"in e){this.diffConf=e.diffConfig}if("orientation"in e){let t=e.orientation!="b-a";if(t!=(this.editorDOM.firstChild==this.a.dom.parentNode)){let e=this.a.dom.parentNode,r=this.b.dom.parentNode;e.remove();r.remove();this.editorDOM.insertBefore(t?e:r,this.editorDOM.firstChild);this.editorDOM.appendChild(t?r:e);this.revertToLeft=!this.revertToLeft;if(this.revertDOM)this.revertDOM.textContent=""}}if("revertControls"in e||"renderRevertControl"in e){let t=!!this.revertDOM,r=this.revertToA,i=this.renderRevert;if("revertControls"in e){t=!!e.revertControls;r=e.revertControls=="b-to-a"}if("renderRevertControl"in e)i=e.renderRevertControl;this.setupRevertControls(t,r,i)}let t="highlightChanges"in e,r="gutter"in e,i="collapseUnchanged"in e;if(t||r||i){let n=[],o=[];if(t||r){let i=this.a.state.facet(U);let l=r?e.gutter!==false:i.markGutter;let s=t?e.highlightChanges!==false:i.highlightChanges;n.push(Le.reconfigure([U.of({side:"a",sibling:()=>this.b,highlightChanges:s,markGutter:l}),l?oe:[]]));o.push(Le.reconfigure([U.of({side:"b",sibling:()=>this.a,highlightChanges:s,markGutter:l}),l?oe:[]]))}if(i){let t=Oe.reconfigure(e.collapseUnchanged?Me(e.collapseUnchanged):[]);n.push(t);o.push(t)}this.a.dispatch({effects:n});this.b.dispatch({effects:o})}this.scheduleMeasure()}setupRevertControls(e,t,r){this.revertToA=t;this.revertToLeft=this.revertToA==(this.editorDOM.firstChild==this.a.dom.parentNode);this.renderRevert=r;if(!e&&this.revertDOM){this.revertDOM.remove();this.revertDOM=null}else if(e&&!this.revertDOM){this.revertDOM=this.editorDOM.insertBefore(document.createElement("div"),this.editorDOM.firstChild.nextSibling);this.revertDOM.addEventListener("mousedown",(e=>this.revertClicked(e)));this.revertDOM.className="cm-merge-revert"}else if(this.revertDOM){this.revertDOM.textContent=""}}scheduleMeasure(){if(this.measuring<0){let e=this.dom.ownerDocument.defaultView||window;this.measuring=e.requestAnimationFrame((()=>{this.measuring=-1;this.measure()}))}}measure(){be(this.a,this.b,this.chunks);if(this.revertDOM)this.updateRevertButtons()}updateRevertButtons(){let e=this.revertDOM,t=e.firstChild;let r=this.a.viewport,i=this.b.viewport;for(let n=0;n<this.chunks.length;n++){let o=this.chunks[n];if(o.fromA>r.to||o.fromB>i.to)break;if(o.fromA<r.from||o.fromB<i.from)continue;let l=this.a.lineBlockAt(o.fromA).top+"px";while(t&&+t.dataset.chunk<n)t=Te(t);if(t&&t.dataset.chunk==String(n)){if(t.style.top!=l)t.style.top=l;t=t.nextSibling}else{e.insertBefore(this.renderRevertButton(l,n),t)}}while(t)t=Te(t)}renderRevertButton(e,t){let r;if(this.renderRevert){r=this.renderRevert()}else{r=document.createElement("button");let e=this.a.state.phrase("Revert this chunk");r.setAttribute("aria-label",e);r.setAttribute("title",e);r.textContent=this.revertToLeft?"⇜":"⇝"}r.style.top=e;r.setAttribute("data-chunk",String(t));return r}revertClicked(e){let t=e.target,r;while(t&&t.parentNode!=this.revertDOM)t=t.parentNode;if(t&&(r=this.chunks[t.dataset.chunk])){let[t,i,n,o,l,s]=this.revertToA?[this.b,this.a,r.fromB,r.toB,r.fromA,r.toA]:[this.a,this.b,r.fromA,r.toA,r.fromB,r.toB];let a=t.state.sliceDoc(n,Math.max(n,o-1));if(n!=o&&s<=i.state.doc.length)a+=t.state.lineBreak;i.dispatch({changes:{from:l,to:Math.min(i.state.doc.length,s),insert:a},userEvent:"revert"});e.preventDefault()}}destroy(){this.a.destroy();this.b.destroy();if(this.measuring>-1)(this.dom.ownerDocument.defaultView||window).cancelAnimationFrame(this.measuring);this.dom.remove()}}function Te(e){let t=e.nextSibling;e.remove();return t}const Re=new class extends i.GutterMarker{constructor(){super(...arguments);this.elementClass="cm-deletedLineGutter"}};const Ve=o.Prec.low((0,i.gutter)({class:"cm-changeGutter",markers:e=>{var t;return((t=e.plugin(ne))===null||t===void 0?void 0:t.gutter)||o.RangeSet.empty},widgetMarker:(e,t)=>t instanceof _e?Re:null}));function Ge(e){let t=typeof e.original=="string"?o.Text.of(e.original.split(/\r?\n/)):e.original;let r=e.diffConfig||ie;return[o.Prec.low(ne),Ie,Se,i.EditorView.editorAttributes.of({class:"cm-merge-b"}),o.EditorState.transactionExtender.of((e=>{let t=e.effects.find((e=>e.is(Ne)));if(!e.docChanged&&!t)return null;let i=e.startState.field(z);let n=t?J.updateA(i,t.value.doc,e.newDoc,t.value.changes,r):J.updateB(i,e.startState.field(He),e.newDoc,e.changes,r);return{effects:q.of(n)}})),U.of({highlightChanges:e.highlightChanges!==false,markGutter:e.gutter!==false,syntaxHighlightDeletions:e.syntaxHighlightDeletions!==false,mergeControls:e.mergeControls!==false,side:"b"}),He.init((()=>t)),e.gutter!==false?Ve:[],z.init((e=>J.build(t,e.doc,r)))]}const Ne=o.StateEffect.define();function Fe(e,t){return Ne.of({doc:t.apply(Pe(e)),changes:t})}const He=o.StateField.define({create:()=>o.Text.empty,update(e,t){for(let r of t.effects)if(r.is(Ne))e=r.value.doc;return e}});function Pe(e){return e.field(He)}const je=new WeakMap;class _e extends i.WidgetType{constructor(e){super();this.buildDOM=e;this.dom=null}eq(e){return this.dom==e.dom}toDOM(e){return this.dom||(this.dom=this.buildDOM(e))}}function Ue(e,t){let r=je.get(t.changes);if(r)return r;let n=r=>{let{highlightChanges:i,syntaxHighlightDeletions:n,mergeControls:o}=e.facet(U);let l=r.state.field(He).sliceString(t.fromA,t.endA);let s=n&&e.facet(f.language);let a=document.createElement("div");a.className="cm-deletedChunk";if(o){let t=a.appendChild(document.createElement("div"));t.className="cm-chunkButtons";let i=t.appendChild(document.createElement("button"));i.name="accept";i.textContent=e.phrase("Accept");i.onmousedown=e=>{e.preventDefault();qe(r,r.posAtDOM(a))};let n=t.appendChild(document.createElement("button"));n.name="reject";n.textContent=e.phrase("Reject");n.onmousedown=e=>{e.preventDefault();ze(r,r.posAtDOM(a))}}let c=a.appendChild(document.createElement("del"));let d=t.changes,u=0,m=false;function g(e,t,r){for(let n=e;n<t;){let e=t,o=r+(m?" cm-deletedText":""),s=false;if(i&&u<d.length){let t=Math.max(0,m?d[u].toA:d[u].fromA);if(t<=e){e=t;if(m)u++;s=true}}if(e>n){let t=document.createTextNode(l.slice(n,e));if(o){let e=c.appendChild(document.createElement("span"));e.className=o;e.appendChild(t)}else{c.appendChild(t)}}n=e;if(s)m=!m}}if(s){let t=s.parser.parse(l),r=0;(0,h.highlightTree)(t,{style:t=>(0,f.highlightingFor)(e,t)},((e,t,i)=>{if(e>r)g(r,e,"");g(e,t,i);r=t}));g(r,l.length,"")}else{g(0,l.length,"")}return a};let o=i.Decoration.widget({block:true,side:-1,widget:new _e(n)});je.set(t.changes,o);return o}function qe(e,t){let{state:r}=e,i=t!==null&&t!==void 0?t:r.selection.main.head;let n=e.state.field(z).find((e=>e.fromB<=i&&e.endB>=i));if(!n)return false;let l=e.state.sliceDoc(n.fromB,Math.max(n.fromB,n.toB-1));let s=e.state.field(He);if(n.fromB!=n.toB&&n.toA<=s.length)l+=e.state.lineBreak;let a=o.ChangeSet.of({from:n.fromA,to:Math.min(s.length,n.toA),insert:l},s.length);e.dispatch({effects:Ne.of({doc:a.apply(s),changes:a}),userEvent:"accept"});return true}function ze(e,t){let{state:r}=e,i=t!==null&&t!==void 0?t:r.selection.main.head;let n=r.field(z).find((e=>e.fromB<=i&&e.endB>=i));if(!n)return false;let o=r.field(He);let l=o.sliceString(n.fromA,Math.max(n.fromA,n.toA-1));if(n.fromA!=n.toA&&n.toB<=r.doc.length)l+=r.lineBreak;e.dispatch({changes:{from:n.fromB,to:Math.min(r.doc.length,n.toB),insert:l},userEvent:"revert"});return true}function We(e){let t=new o.RangeSetBuilder;for(let r of e.field(z))t.add(r.fromB,r.fromB,Ue(e,r));return t.finish()}const Ie=o.StateField.define({create:e=>We(e),update(e,t){return t.state.field(z,false)!=t.startState.field(z,false)?We(t.state):e},provide:e=>i.EditorView.decorations.from(e)})}}]);