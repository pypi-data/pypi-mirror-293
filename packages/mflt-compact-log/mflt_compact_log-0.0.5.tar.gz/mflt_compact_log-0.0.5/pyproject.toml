[tool.poetry]
name = "mflt-compact-log"
version = "0.0.5"
description = "Memfault Compact Log Library"
authors = ["Memfault Inc <hello@memfault.com>"]
repository = "https://github.com/memfault/memfault-firmware-sdk"
readme = "README.md"
license = "Proprietary"

packages = [{ include = "mflt_compact_log", from = "src" }]
exclude = [
  "**/*.c",
  "**/*.h",
  "src/mflt_compact_log/decode/scripts",
  "src/mflt_compact_log/decode/Dockerfile",
  "src/mflt_compact_log/decode/native_engine.py",
]

[tool.poetry.dependencies]
python = "^3.8"
cbor2 = "^5"
click = "^8.0"
prettytable = "^3"
pyelftools = "^0.31"

# for python 3.10, there aren't v1.0.0 releases of the below packages. instead,
# select separately built+uploaded versions of those packages. generated from
# here: https://github.com/noahp/wasmer-python/tree/1.0.0-build
#
# updating to newer versions of the wasmer packages was problematic; some linker
# errors when building native .so's
wasmer = { version = "==1.0.0", python = ">=3.8 <3.10" }
wasmer-py310 = { version = "==1.0.0", python = "~3.10" }
wasmer-compiler-cranelift = { version = "==1.0.0", python = ">=3.8 <3.10" }
wasmer-compiler-cranelift-py310 = { version = "==1.0.0", python = "~3.10" }

[tool.poetry.group.dev.dependencies]
invoke = "1.4.1"
pytest = ">=6"
pytest-cov = "^2"
snappy = { path = "../snappy", develop = true }

[tool.poetry.scripts]
"mflt-compact-log.compact" = 'mflt_compact_log.compact:main'
"mflt-compact-log.log_fmt" = 'mflt_compact_log.log_fmt:main'

# set an empty pytest config section, to prevent pytest from walking up the
# directory tree trying to find a config file
[tool.pytest.ini_options]

#
# NB: Uncommenting these lines will prevent installing the project in editable mode.
#
# [build-system]
# requires = ["poetry>=0.12"]
# build-backend = "poetry.masonry.api"
