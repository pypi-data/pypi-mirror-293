# Проект mory

## Описание проекта

Проект mory предназначен для взаимодействия с моделью OpenAI GPT-4. С помощью данного проекта вы можете автоматизировать взаимодействие с моделью через командную строку, в том числе выполнять сканирование файловой системы, отправку запросов к GPT-4 и применение изменений к исходному коду на основе ответов модели.

## Содержание

- [Проект mory](#проект-mory)
  - [Описание проекта](#описание-проекта)
  - [Содержание](#содержание)
  - [Основные возможности](#основные-возможности)
  - [Установка](#установка)
    - [1. Убедитесь, что у вас установлен Python и pip](#1-убедитесь-что-у-вас-установлен-python-и-pip)
    - [2. Установите проект через pip](#2-установите-проект-через-pip)
  - [Использование](#использование)
    - [Проверка установки](#проверка-установки)
    - [Основные команды](#основные-команды)
      - [Сканирование директории](#сканирование-директории)
      - [Открытие конфигурационного файла](#открытие-конфигурационного-файла)
  - [Архитектура проекта](#архитектура-проекта)
  - [Подробное описание скриптов](#подробное-описание-скриптов)
    - [`requirements.txt`](#requirementstxt)
    - [`scan.py`](#scanpy)
      - [Основные функции](#основные-функции)
    - [`chat.py`](#chatpy)
      - [Основные функции](#основные-функции-1)
    - [`helpers.py`](#helperspy)
      - [Основные функции](#основные-функции-2)
    - [`tests`](#tests)
  - [Тестирование](#тестирование)

## Основные возможности

- Получение ответов от модели OpenAI GPT-4.
- Возможность сохранения ответов в файл Markdown.
-  **Пока нет, но это цель** - применение изменений к исходному коду на основе ответов модели.
- Удобный интерфейс командной строки для взаимодействия с пользователем.

## Установка

Для установки проекта через pip выполните следующие шаги:

### 1. Убедитесь, что у вас установлен Python и pip

Перед началом установки убедитесь, что у вас установлены Python и pip. Вы можете проверить это, выполнив следующие команды:

```sh
python --version
pip --version
```

### 2. Установите проект через pip

Теперь вы можете установить проект, указав путь к созданному файлу пакета:

```sh
pip install mory
```

## Использование

После установки проекта через pip, вы можете использовать команду `mory` для взаимодействия с проектом.
Убедитесь, что у вас установлен ключ API OpenAI в переменную окружения `OPENAI_API_KEY`.

### Проверка установки

Убедитесь, что проект установлен правильно, выполнив следующую команду:

```sh
mory --version
```

Вы должны увидеть версию установленного проекта, например: `mory 0.2.4`.

### Основные команды

#### Сканирование директории

Для сканирования директории используйте команду `scan`:

```sh
mory scan -p путь/к/директории
```

Если путь не указан, сканирование будет произведено в текущей директории.

#### Открытие конфигурационного файла

Для открытия конфигурационного файла используйте команду `config`:

```sh
mory config
```

Эта команда откроет конфигурационный файл для редактирования.

## Архитектура проекта

Проект построен на модульной архитектуре, все основные функции разделены на отдельные файлы для удобства поддержки и расширения функциональности.

Структура файлов:

```
.
├── LICENSE
├── README.md
├── requirements.txt
├── setup.py
├── mory
│   ├── __init__.py
│   ├── chat.py
│   ├── config_loader.py
│   ├── conversation.py
│   ├── helpers.py
│   ├── main.py
│   ├── scan.py
│   ├── tools.py
│   └── version.py
├── templates
│   ├── config.yml
│   └── .gptignore
└── tests
    ├── __init__.py
    ├── test_run.py
    └── test_scan.py
```

## Подробное описание скриптов

### `requirements.txt`

Файл, содержащий список всех зависимостей проекта. Используется для установки необходимых библиотек с помощью команды `pip install -r requirements.txt`.

### `scan.py`

Скрипт для сканирования файлов и обработки игнорируемых файлов.

#### Основные функции

- `read_ignore_file(ignore_files)`: Читает файлы .ignore и возвращает список шаблонов для игнорирования.
- `should_ignore(path, patterns)`: Проверяет, следует ли игнорировать данный путь на основе шаблонов.
- `is_text_file(file_path)`: Проверяет, является ли файл текстовым или бинарным.
- `get_text_files(root, ignore_patterns)`: Сканирует папку и возвращает список текстовых файлов, исключая игнорируемые.
- `read_file_content(file_path)`: Читает содержимое текстового файла.
- `scan(root_folder, ignore_pattern_files)`: Сканирует корневую папку и возвращает содержимое всех текстовых файлов, исключая игнорируемые.

### `chat.py`

Скрипт для общения с моделью OpenAI GPT-4.

#### Основные функции

- `chat_completion_request(messages, tools=None, tool_choice=None, model=gpt_model)`: Функция для отправки запросов к модели GPT-4 с повторными попытками при сбоях.

### `helpers.py`

Вспомогательные функции для проекта.

#### Основные функции

- `check_api_key()`: Проверяет наличие ключа API в переменной окружения.
- `get_string_size_kb(string)`: Возвращает размер строки в килобайтах.
- `pretty_print_message(message)`: Форматирует и выводит сообщения в цвете.
- `save_response_to_file(response, temp_dir)`: Сохраняет ответ в файл.

### `tests`

Папка с тестами для проекта. Включает тесты для проверки основных функций.

## Тестирование

Для запуска тестов используйте:

```sh
python -m unittest discover -s tests
```

Тесты включают проверку основных функций и сценариев использования.