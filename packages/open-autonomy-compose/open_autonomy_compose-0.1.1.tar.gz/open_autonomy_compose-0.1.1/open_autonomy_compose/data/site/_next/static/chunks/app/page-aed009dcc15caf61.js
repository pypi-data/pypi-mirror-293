(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8476:function(t,e,o){Promise.resolve().then(o.bind(o,388))},388:function(t,e,o){"use strict";o.r(e),o.d(e,{default:function(){return p}});var n=o(7437),s=o(2265);function a(t){var e=t.toString(16);return 1==e.length?"0"+e:e}class i{addApp(t){return void 0===this.apps[t]&&(this.apps[t]={index:this._app_count++,color:"#".concat(a(Math.round(80*Math.random())+150)).concat(a(Math.round(80*Math.random())+150)).concat(a(Math.round(80*Math.random())+150))}),this.apps[t]}addNode(t,e){void 0===this.nodes[e]&&(this.nodes[e]=[]),this.nodes[e].push(t)}addEdge(t,e,o){console.log(t,e),this.edges.push({id:"".concat(t,"-").concat(o,"->").concat(e),source:t,target:e,animated:!0,label:o}),void 0==this._edge_count[t]&&(this._edge_count[t]={in:0,out:0}),this._edge_count[t].out+=1,void 0==this._edge_count[e]&&(this._edge_count[e]={in:0,out:0}),this._edge_count[e].in+=1}getNodes(){let t=[],e=0,o=this._edge_count;for(let n in this.nodes){let s=0,a=0;this.nodes[n].map(function(i){let d=o["".concat(i.data.app,".").concat(i.data.label)];d.in>5&&(e+=1),i.position.y=Math.floor((Number(n)+e)*100),i.position.x=s+Math.floor(30*a),t.push(i),s+=Math.floor(10*i.data.label.length)+50,a=d.out>3?d.out:0})}return t}constructor(){this.apps={},this.nodes={},this.edges=[],this._app_count=0,this._visited=[],this._edge_count={}}}var d=o(6816);function r(t){let{data:e}=t;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d.HH,{type:"target",position:d.Ly.Top}),(0,n.jsx)("div",{style:{border:"3px solid #333",padding:"5px",borderRadius:"5px",background:e.color},children:e.label}),(0,n.jsx)(d.HH,{type:"source",position:d.Ly.Bottom,id:"a"})]})}let l={name:void 0,events:[],start_state:void 0,initial_states:[],final_states:[],transitions:{}};o(8473);var c=o(3774),u=o(1611);function p(){let[t,e]=(0,s.useState)(l),[o,a]=(0,s.useState)([]),[p,h]=(0,s.useState)([]),[g,f]=(0,s.useState)({}),x=(0,s.useMemo)(()=>({stateNode:r}),[]),_=(0,s.useCallback)(t=>h(e=>(0,d.Fb)(t,e)),[]),v=(0,s.useCallback)(t=>a(e=>(0,d.yn)(t,e)),[]);function b(){fetch("http://localhost:8000/fsm").then(async function(t){e({...await t.json()})})}return(0,s.useEffect)(function(){let e,o,n;if(void 0===t.start_state)return;console.log("Rendering graph...");let s=(e=[],o={},n=new i,function t(s,a,i,d){let[r,l]=s.split("."),c=n.addApp(r);for(let u in o[r]=c.color,n.addNode({id:s,position:{x:0,y:0},data:{label:l,color:c.color,app:r},type:"stateNode"},d.level),n.addEdge(d.name,s,d.event),e.push("".concat(d,"-").concat(d.event,"->").concat(s)),a[s]){let e=a[s][u];-1===i.indexOf(e)?(i.push(e),t(e,a,i,{name:s,level:d.level+1,event:u})):n.addEdge(s,e,u)}}(t.start_state?t.start_state:"DummyState",t.transitions,[],{name:"Start",level:0,event:"START"}),{colors:o,edges:n.edges,nodes:n.getNodes()});f(s.colors),a(s.edges),h(s.nodes)},[t]),(0,s.useEffect)(function(){void 0===t.name&&(console.log("Fetching FSM at load..."),b())},[t]),(0,n.jsx)("div",{style:{width:"100vw",height:"100vh"},children:(0,n.jsxs)(d.x$,{nodes:p,onNodesChange:_,edges:o,onEdgesChange:v,nodeTypes:x,fitView:!0,children:[(0,n.jsxs)(d.s_,{position:"top-left",style:{border:"2px solid #333",padding:"5px",borderRadius:"3px",background:"#fff",display:"flex"},children:[(0,n.jsx)("div",{children:t.name?t.name.split(".")[1]:""}),"\xa0",(0,n.jsx)("div",{children:"|"}),"\xa0",(0,n.jsx)("div",{onClick:b,style:{cursor:"pointer"},children:"\uD83D\uDD04"})]}),(0,n.jsx)(d.s_,{position:"top-right",style:{border:"2px solid #333",padding:"5px",borderRadius:"3px",background:"#fff"},children:Object.keys(g).map(function(t,e){return(0,n.jsxs)("div",{style:{display:"flex"},children:[(0,n.jsx)("div",{style:{background:g[t],height:"20px",width:"40px",border:"2px solid #333",borderRadius:"3px"}}),"\xa0 \xa0",t]},e)})}),(0,n.jsx)(c.a,{nodeColor:t=>g[t.data.app],title:"Composer",nodeStrokeWidth:3,zoomable:!0,pannable:!0}),(0,n.jsx)(u.Z,{})]})})}}},function(t){t.O(0,[780,213,971,596,744],function(){return t(t.s=8476)}),_N_E=t.O()}]);