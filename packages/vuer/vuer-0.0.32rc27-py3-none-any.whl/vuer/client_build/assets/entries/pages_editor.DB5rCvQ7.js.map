{"version":3,"file":"pages_editor.DB5rCvQ7.js","sources":["../../../../pages/editor/SceneFileDropContainer.tsx","../../../../pages/editor/+Page.tsx"],"sourcesContent":["import { FileDropContainer, FileDropContainerProps, ServerEvent, Store, UpsertOp } from '@vuer-ai/vuer';\nimport { PropsWithChildren, useCallback } from 'react';\n\ntype Props = PropsWithChildren<{\n  stream: Store<ServerEvent>;\n} & Omit<FileDropContainerProps, 'onLoad'>>\n\nexport const SceneFileDropContainer = (\n  {\n    stream,\n    children,\n    ...props\n  }: Props,\n) => {\n  const onLoad = useCallback((\n    files: Record<string, string>,\n    clearCache: () => void,\n  ): void => {\n    Object.keys(files).forEach((entryPath, i) => {\n      const ext = entryPath.toLowerCase().split('.').pop();\n      let tag, src, rotation;\n      if (ext === 'urdf') {\n        tag = 'Urdf';\n        src = entryPath;\n        rotation = [-90, 0, 0].map((d) => (d * Math.PI) / 180);\n      } else if (ext === 'obj') {\n        tag = 'Obj';\n        src = files[entryPath];\n        rotation = [-90, 0, 0].map((d) => (d * Math.PI) / 180);\n      } else if (ext === 'pcd') {\n        tag = 'Pcd';\n        src = files[entryPath];\n        rotation = [-90, 0, 0].map((d) => (d * Math.PI) / 180);\n      } else if (ext === 'ply') {\n        tag = 'Ply';\n        src = files[entryPath];\n        rotation = [-90, 0, 0].map((d) => (d * Math.PI) / 180);\n      } else if (ext === 'splat') {\n        tag = 'Splat';\n        src = files[entryPath];\n        rotation = [-90, 0, -90].map((d) => (d * Math.PI) / 180);\n      } else if (ext === 'glb') {\n        tag = 'Glb';\n        src = files[entryPath];\n        rotation = [0, 0, 0];\n      } else if (ext === 'gltf') {\n        tag = 'Glb';\n        src = files[entryPath];\n        rotation = [0, 0, 0];\n      }\n\n      if (!tag) return;\n\n      stream.publish(\n        UpsertOp([\n          {\n            tag,\n            src,\n            key: `${entryPath}`,\n            assets: files,\n            rotation,\n          },\n        ]),\n      );\n    });\n    // clear the file list without revoking the blob urls.\n    clearCache();\n  }, [stream]);\n\n\n  return (\n    <FileDropContainer onLoad={onLoad} {...props}>\n      {children}\n    </FileDropContainer>\n  );\n};","import React, { useEffect, useMemo } from 'react';\nimport { Helmet } from '@vuer-ai/react-helmet-async';\nimport './index.scss';\nimport {\n  AmbientLight,\n  Grid,\n  Hands,\n  PlaybackBar,\n  PlaybackProvider,\n  PointLight,\n  ResizableSwitch,\n  WebSocketProvider,\n  Timeline,\n  SceneContainer,\n  useSocket,\n  Combine,\n  PlaybackStateProvider,\n  usePlayback,\n  TimelineStateProvider,\n  Resizable,\n  GraphView,\n  useSceneStore,\n  TimelineFileDrop,\n} from '@vuer-ai/vuer';\nimport { Leva } from 'leva';\nimport { SceneFileDropContainer } from './SceneFileDropContainer';\n\nfunction VuerPlayback() {\n  const playback = usePlayback();\n  const { downlink } = useSocket();\n\n  useEffect(() => {\n    if (!playback) return;\n    const cancel = [\n      downlink.subscribe('SET', playback.addKeyFrame),\n      downlink.subscribe('ADD', playback.addKeyFrame),\n      downlink.subscribe('UPDATE', playback.addKeyFrame),\n      downlink.subscribe('UPSERT', playback.addKeyFrame),\n      downlink.subscribe('REMOVE', playback.addKeyFrame),\n    ];\n\n    return () => {\n      cancel.forEach((f) => f());\n    };\n  }, [playback, downlink]);\n\n\n  const combinedStream = useMemo(\n    () => {\n      if (!playback?.store) return downlink;\n      return new Combine(downlink, playback.store);\n    },\n    [downlink, playback?.store],\n  );\n\n\n  if (!playback) {\n    return (\n      <SceneFileDropContainer stream={combinedStream}>\n        <SceneContainer\n          frameloop=\"always\"\n          stream={downlink}\n          bgChildren={[\n            <Grid key=\"default-grid\" _key=\"default-grid\" />,\n            <AmbientLight key=\"ambient\" intensity={0.25} />,\n            <PointLight key=\"spot\" intensity={1} position={[0, 1, 1]} />,\n            <Hands fps={30} eventType={['squeeze']} stream />,\n          ]}\n        />\n      </SceneFileDropContainer>\n    );\n  } else return (\n    <ResizableSwitch\n      offset={200}\n      minOffset={48}\n      hidden={true}\n      style={{\n        width: '100%',\n        height: '100%',\n      }}\n    >\n      <SceneFileDropContainer\n        stream={combinedStream}\n        prompt={'scene files supported: *.urdf *.pcd *.ply *.splat'}\n      >\n        <SceneContainer\n          frameloop=\"always\"\n          stream={combinedStream}\n          bgChildren={[\n            <Grid key=\"default-grid\" _key=\"default-grid\" />,\n            <AmbientLight key=\"ambient\" intensity={0.25} />,\n            <PointLight key=\"spot\" intensity={1} position={[0, 1, 1]} />,\n            <Hands fps={30} eventType={['squeeze']} stream />,\n          ]}\n        />\n      </SceneFileDropContainer>\n      <>\n        <PlaybackStateProvider>\n          <TimelineStateProvider>\n            <PlaybackBar />\n            <TimelineFileDrop>\n              <Timeline />\n              {/*{clips.map((clip, i)=>{*/}\n              {/*  return <Clip {...clip} onDrag onSelectStart onSelectEnd/>*/}\n              {/*})}*/}\n            </TimelineFileDrop>\n          </TimelineStateProvider>\n        </PlaybackStateProvider>\n      </>\n      <PlaybackStateProvider>\n        <TimelineStateProvider>\n          <PlaybackBar />\n        </TimelineStateProvider>\n      </PlaybackStateProvider>\n    </ResizableSwitch>\n  );\n}\n\nfunction SidePanelView() {\n  // this is excessive. triggers when position/rotation changes too.\n  // const scene = useSceneStore(({ children, bgChildren, rawChildren }) =>\n  //   ({ children, bgChildren, rawChildren }));\n  const children = useSceneStore(({ children }) => children);\n  const sceneOps = useSceneStore(({ ops }) => ops);\n  // return <VuerPlayback />;\n\n  return (\n    <Resizable vertical offset={-200} hidden={true}>\n      <VuerPlayback />\n      <GraphView\n        title=\"Scene Graph\"\n        nodes={children}\n        sceneOps={sceneOps}\n      />\n    </Resizable>\n  );\n}\n\nexport default function Page() {\n  const isSSR = typeof window === 'undefined';\n\n  return (\n    <>\n      <Helmet>\n        <title>Vuer | Stereo Video and WebRTC Demo</title>\n      </Helmet>\n      <main>\n        <PlaybackProvider>\n          {\n            isSSR ? null : (\n              <WebSocketProvider>\n                {/*<VuerPlayback />*/}\n                <SidePanelView />\n              </WebSocketProvider>\n            )\n          }\n        </PlaybackProvider>\n        <Leva\n          theme={{\n            sizes: {\n              rootWidth: '380px',\n              controlWidth: '200px',\n              numberInputMinWidth: '56px',\n            },\n          }}\n        />\n      </main>\n    </>\n  );\n}"],"names":["SceneFileDropContainer","stream","children","props","onLoad","useCallback","files","clearCache","entryPath","i","ext","tag","src","rotation","d","UpsertOp","jsx","FileDropContainer","VuerPlayback","playback","usePlayback","downlink","useSocket","useEffect","cancel","f","combinedStream","useMemo","Combine","jsxs","ResizableSwitch","SceneContainer","Grid","AmbientLight","PointLight","Hands","Fragment","PlaybackStateProvider","TimelineStateProvider","PlaybackBar","TimelineFileDrop","Timeline","SidePanelView","useSceneStore","sceneOps","ops","Resizable","GraphView","Page","isSSR","Helmet","PlaybackProvider","WebSocketProvider","Leva"],"mappings":"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"}