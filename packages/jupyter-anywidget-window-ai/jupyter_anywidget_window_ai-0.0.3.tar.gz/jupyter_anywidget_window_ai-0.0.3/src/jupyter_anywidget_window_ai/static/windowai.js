var d=`<div class="windowai-app-container">

    <h1><tt>windowai</tt></h1>
    <div>Jupyter Widget to access in-browser LLM via  <tt>window.ai</tt></div>
    <div title="system_prompt" class="system-prompt-div">SYSTEM PROMPT:</div>
    <div title="response" class="response-div"></div>
</div>`;function h(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let n=Math.random()*16|0;return(t==="x"?n:n&3|8).toString(16)})}function y(t,n,c=!1){let o=document.createElement("div");o.innerHTML=n;let u=h();o.id=u,c&&(o.style="display: none; visibility: hidden;"),t.appendChild(o)}function m(t=!0,n=null,c=440,o=1e3,u=.1,r="sine"){if(t){let s=new(window.AudioContext||window.webkitAudioContext),i=s.createOscillator(),e=s.createGain();e.gain.value=u,i.type=r,i.frequency.value=c,i.connect(e),e.connect(s.destination),i.start(),e.gain.exponentialRampToValueAtTime(1e-5,s.currentTime+o/1e3),setTimeout(()=>{i.stop(),n&&setTimeout(()=>{f(n)},100)},o)}else n&&f(n)}var f=t=>{if(t){let n=new SpeechSynthesisUtterance(t);window.speechSynthesis.speak(n)}};async function g({model:t,el:n}){let c=t.get("headless");y(n,d,c);let o=n.querySelector('div[title="system_prompt"]'),u=n.querySelector('div[title="response"]'),r=null;t.on("change:output",()=>{u.textContent=t.get("output")}),t.on("change:system_prompt",()=>{o.textContent=`SYSTEM PROMPT: ${t.get("system_prompt")}`}),t.on("change:_refresh_capabilities",async()=>{let i=await window.ai.assistant.capabilities();t.set("capabilities",{available:i.available,defaultTemperature:i.capabilities,defaultTopK:i.defaultTopK,maxTopK:i.maxTopK}),t.save_changes()}),t.on("msg:custom",async i=>{if(!r)try{let e={},a=t.get("system_prompt");a&&(e.systemPrompt=a);let p=t.get("initial_prompts");p&&(e.initialPrompts=p);let x=t.get("temperature");x!=-1&&(e.temperature=x);let l=t.get("topK");l>-1&&(e.topK=l),console.log(`Creating model with optons: ${JSON.stringify(e)}`),r=await window.ai.assistant.create(e)}catch(e){console.error("Failed to create AI session:",e),s("Error: Failed to create AI session",i.request_id);return}if(i.action==="prompt")try{u.textContent="[Processing prompt...]";let e=await r.prompt(i.message),a=t.get("speak_msg")?e:"",p=t.get("completion_tone");s(e,i.request_id,p,a)}catch(e){console.error("Error getting AI response:",e),s("Error: "+e.message,i.request_id)}else if(i.action==="prompt_streaming")try{let e=await r.promptStreaming(i.message);for await(let a of e)s(a,i.request_id)}catch(e){console.error("Error streaming AI response:",e),s("Error: "+e.message,i.request_id)}else i.action==="destroy"&&(r&&(r.destroy(),r=null,t.set("output","[Session closed]"),t.save_changes()),s("[Session destroyed]",i.request_id))});function s(i,e,a=!1,p=""){t.set("output",i),t.set("_request_id",e),t.save_changes(),(a||p)&&m(a,p,1e3,100,.1,"sine")}}var C={render:g};export{C as default};
